<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP Audit Report - {{.TargetURL}}</title>
    <script src="{{.ChartJSURL}}"></script>
    <style>
        :root {
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --info-color: #3b82f6;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-left: 1rem;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
        }

        .status-partial {
            background: #fef3c7;
            color: #92400e;
        }

        .status-failed {
            background: #fee2e2;
            color: #991b1b;
        }

        .card {
            background: var(--card-bg);
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .card-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-header h2 {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .card-body {
            padding: 1.5rem;
        }

        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            text-align: center;
            padding: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--info-color);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .tag {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .tag-success {
            background: #d1fae5;
            color: #065f46;
        }

        .tag-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .tag-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .tag-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .warning-list {
            list-style: none;
        }

        .warning-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .warning-list li:last-child {
            border-bottom: none;
        }

        .warning-icon {
            color: var(--warning-color);
        }

        .cert-card {
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .cert-card:last-child {
            margin-bottom: 0;
        }

        .cert-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .cert-detail {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .collapsible {
            cursor: pointer;
        }

        .collapsible-content {
            display: none;
        }

        .collapsible-content.show {
            display: block;
        }

        .icon {
            width: 1.25rem;
            height: 1.25rem;
        }

        footer {
            margin-top: 2rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                HTTP Audit Report
                <span class="status-badge status-{{.Summary.OverallStatus}}">
                    {{if eq .Summary.OverallStatus "success"}}Success{{else if eq .Summary.OverallStatus "partial"}}Partial{{else}}Failed{{end}}
                </span>
            </h1>
            <p class="subtitle">
                <strong>Target:</strong> {{.TargetURL}} |
                <strong>Generated:</strong> {{.Timestamp.Format "2006-01-02 15:04:05 MST"}}
                {{if and .Proxy .Proxy.Enabled}}
                <br><strong>Proxy:</strong> {{.Proxy.URL}}{{if .Proxy.AuthType}} ({{.Proxy.AuthType}} auth){{end}}
                {{end}}
            </p>
        </header>

        <!-- Summary -->
        <div class="card">
            <div class="card-header">
                <h2>Summary</h2>
            </div>
            <div class="card-body">
                <div class="grid grid-4">
                    <div class="stat-card">
                        <div class="stat-value">{{.Summary.TotalSteps}}</div>
                        <div class="stat-label">Total Steps</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--success-color)">{{.Summary.SuccessSteps}}</div>
                        <div class="stat-label">Successful</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--error-color)">{{.Summary.FailedSteps}}</div>
                        <div class="stat-label">Failed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{printf "%.0f" .Timings.Total.Milliseconds}}ms</div>
                        <div class="stat-label">Total Time</div>
                    </div>
                </div>

                {{if .Summary.Warnings}}
                <div style="margin-top: 1.5rem;">
                    <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">Warnings</h3>
                    <ul class="warning-list">
                        {{range .Summary.Warnings}}
                        <li>
                            <span class="warning-icon">⚠️</span>
                            {{.}}
                        </li>
                        {{end}}
                    </ul>
                </div>
                {{end}}
            </div>
        </div>

        <!-- Timing Chart -->
        <div class="card">
            <div class="card-header">
                <h2>Request Timing Breakdown</h2>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="timingChart"></canvas>
                </div>
            </div>
        </div>

        <div class="grid grid-2">
            {{if and .Proxy .Proxy.Enabled}}
            <!-- Proxy Results -->
            <div class="card">
                <div class="card-header">
                    <h2>Proxy Configuration</h2>
                    <span class="tag tag-info">Enabled</span>
                </div>
                <div class="card-body">
                    <table class="table">
                        <tr>
                            <th>Proxy URL</th>
                            <td>{{.Proxy.URL}}</td>
                        </tr>
                        <tr>
                            <th>Host</th>
                            <td>{{.Proxy.Host}}</td>
                        </tr>
                        <tr>
                            <th>Port</th>
                            <td>{{.Proxy.Port}}</td>
                        </tr>
                        <tr>
                            <th>Authentication</th>
                            <td>{{if eq .Proxy.AuthType "none"}}None{{else}}{{.Proxy.AuthType}}{{end}}</td>
                        </tr>
                        {{if .Proxy.Error}}
                        <tr>
                            <th>Error</th>
                            <td style="color: var(--error-color)">{{.Proxy.Error}}</td>
                        </tr>
                        {{end}}
                    </table>
                    {{if .Proxy.ConnectHeaders}}
                    <div style="margin-top: 1rem;">
                        <h3 style="font-size: 0.875rem; margin-bottom: 0.5rem;">Proxy Headers</h3>
                        <div class="code-block" style="max-height: 150px; overflow-y: auto;">{{range $key, $value := .Proxy.ConnectHeaders}}{{$key}}: {{$value}}
{{end}}</div>
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            {{if .DNS}}
            <!-- DNS Results -->
            <div class="card">
                <div class="card-header">
                    <h2>DNS Resolution</h2>
                    <span class="tag {{if .DNS.Success}}tag-success{{else}}tag-error{{end}}">
                        {{if .DNS.Success}}Success{{else}}Failed{{end}}
                    </span>
                </div>
                <div class="card-body">
                    <table class="table">
                        <tr>
                            <th>Hostname</th>
                            <td>{{.DNS.Hostname}}</td>
                        </tr>
                        <tr>
                            <th>Resolved IPs</th>
                            <td>{{range $i, $ip := .DNS.ResolvedIPs}}{{if $i}}, {{end}}{{$ip}}{{end}}</td>
                        </tr>
                        <tr>
                            <th>DNS Server</th>
                            <td>{{.DNS.ServerUsed}}{{if .DNS.FastestServer}} <span class="tag tag-success">Fastest: {{.DNS.FastestServer}}</span>{{end}}</td>
                        </tr>
                        <tr>
                            <th>Duration</th>
                            <td>{{printf "%.2f" .DNS.Duration.Milliseconds}}ms</td>
                        </tr>
                        {{if .DNS.ExpectedIPs}}
                        <tr>
                            <th>Expected IPs</th>
                            <td>
                                {{range $i, $ip := .DNS.ExpectedIPs}}{{if $i}}, {{end}}{{$ip}}{{end}}
                                {{if .DNS.IPsMatch}}
                                <span class="tag tag-success">Match</span>
                                {{else}}
                                <span class="tag tag-warning">Mismatch</span>
                                {{end}}
                            </td>
                        </tr>
                        {{end}}
                        {{if .DNS.Error}}
                        <tr>
                            <th>Error</th>
                            <td style="color: var(--error-color)">{{.DNS.Error}}</td>
                        </tr>
                        {{end}}
                    </table>

                    {{if .DNS.ServerResults}}
                    <!-- DNS Server Comparison -->
                    <div style="margin-top: 1.5rem;">
                        <h3 style="font-size: 1rem; margin-bottom: 0.75rem;">DNS Server Comparison ({{len .DNS.ServerResults}} servers)</h3>
                        <div class="chart-container" style="height: 200px; margin-bottom: 1rem;">
                            <canvas id="dnsChart"></canvas>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>DNS Server</th>
                                    <th>Status</th>
                                    <th>Response Time</th>
                                    <th>Resolved IPs</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range $i, $sr := .DNS.ServerResults}}
                                <tr>
                                    <td>
                                        {{$sr.Server}}
                                        {{if eq $sr.Server $.DNS.FastestServer}}<span class="tag tag-success" style="margin-left: 0.5rem;">Fastest</span>{{end}}
                                    </td>
                                    <td>
                                        {{if $sr.Success}}
                                        <span class="tag tag-success">Success</span>
                                        {{else}}
                                        <span class="tag tag-error">Failed</span>
                                        {{end}}
                                    </td>
                                    <td>{{printf "%.2f" $sr.Duration.Milliseconds}}ms</td>
                                    <td>
                                        {{if $sr.Success}}
                                        {{range $j, $ip := $sr.ResolvedIPs}}{{if $j}}, {{end}}{{$ip}}{{end}}
                                        {{else}}
                                        <span style="color: var(--error-color)">{{$sr.Error}}</span>
                                        {{end}}
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}

            {{if .SSL}}
            <!-- SSL Results -->
            <div class="card">
                <div class="card-header">
                    <h2>SSL/TLS Analysis</h2>
                    <span class="tag {{if .SSL.Success}}tag-success{{else}}tag-error{{end}}">
                        {{if .SSL.Success}}Success{{else}}Failed{{end}}
                    </span>
                </div>
                <div class="card-body">
                    <table class="table">
                        <tr>
                            <th>Protocol</th>
                            <td>{{.SSL.Protocol}}</td>
                        </tr>
                        <tr>
                            <th>Cipher Suite</th>
                            <td><code>{{.SSL.CipherSuite}}</code></td>
                        </tr>
                        <tr>
                            <th>Handshake Time</th>
                            <td>{{printf "%.2f" .SSL.Duration.Milliseconds}}ms</td>
                        </tr>
                        {{if .SSL.Error}}
                        <tr>
                            <th>Error</th>
                            <td style="color: var(--error-color)">{{.SSL.Error}}</td>
                        </tr>
                        {{end}}
                    </table>
                </div>
            </div>
            {{end}}
        </div>

        {{if and .SSL .SSL.Certificates}}
        <!-- Certificates -->
        <div class="card">
            <div class="card-header">
                <h2>Certificate Chain</h2>
            </div>
            <div class="card-body">
                {{range $i, $cert := .SSL.Certificates}}
                <div class="cert-card">
                    <div class="cert-title">
                        {{if eq $i 0}}Server Certificate{{else if $cert.IsCA}}CA Certificate{{else}}Intermediate Certificate{{end}}
                        {{if $cert.IsExpired}}
                        <span class="tag tag-error">Expired</span>
                        {{else if lt $cert.DaysUntilExpiry 30}}
                        <span class="tag tag-warning">Expires in {{$cert.DaysUntilExpiry}} days</span>
                        {{else}}
                        <span class="tag tag-success">Valid</span>
                        {{end}}
                    </div>
                    <div class="cert-detail"><strong>Subject:</strong> {{$cert.Subject}}</div>
                    <div class="cert-detail"><strong>Issuer:</strong> {{$cert.Issuer}}</div>
                    <div class="cert-detail"><strong>Valid From:</strong> {{$cert.NotBefore.Format "2006-01-02"}} <strong>To:</strong> {{$cert.NotAfter.Format "2006-01-02"}}</div>
                    <div class="cert-detail"><strong>Signature:</strong> {{$cert.SignatureAlgorithm}}</div>
                    {{if $cert.DNSNames}}
                    <div class="cert-detail"><strong>DNS Names:</strong> {{range $j, $name := $cert.DNSNames}}{{if $j}}, {{end}}{{$name}}{{end}}</div>
                    {{end}}
                </div>
                {{end}}
            </div>
        </div>

        {{if .SSL.SupportedVersions}}
        <!-- TLS Version Support -->
        <div class="card">
            <div class="card-header">
                <h2>TLS Version Support</h2>
            </div>
            <div class="card-body">
                <div class="chart-container" style="height: 200px;">
                    <canvas id="tlsChart"></canvas>
                </div>
            </div>
        </div>
        {{end}}
        {{end}}

        {{if .HTTP}}
        <!-- HTTP Results -->
        <div class="card">
            <div class="card-header">
                <h2>HTTP Response</h2>
                <span class="tag {{if .HTTP.Success}}tag-success{{else}}tag-error{{end}}">
                    {{if .HTTP.Success}}{{.HTTP.StatusCode}} {{.HTTP.Status}}{{else}}Failed{{end}}
                </span>
            </div>
            <div class="card-body">
                <div class="grid grid-2">
                    <div>
                        <h3 style="font-size: 1rem; margin-bottom: 0.75rem;">Response Details</h3>
                        <table class="table">
                            <tr>
                                <th>Status</th>
                                <td>{{.HTTP.StatusCode}} {{.HTTP.Status}}</td>
                            </tr>
                            <tr>
                                <th>Protocol</th>
                                <td>{{.HTTP.Proto}}</td>
                            </tr>
                            <tr>
                                <th>Content Type</th>
                                <td>{{.HTTP.ContentType}}</td>
                            </tr>
                            <tr>
                                <th>Content Length</th>
                                <td>{{.HTTP.ContentLength}} bytes</td>
                            </tr>
                            <tr>
                                <th>Final URL</th>
                                <td>{{.HTTP.FinalURL}}</td>
                            </tr>
                            {{if .HTTP.RedirectCount}}
                            <tr>
                                <th>Redirects</th>
                                <td>{{.HTTP.RedirectCount}}</td>
                            </tr>
                            {{end}}
                        </table>
                    </div>
                    <div>
                        <h3 style="font-size: 1rem; margin-bottom: 0.75rem;">Response Headers</h3>
                        <div class="code-block" style="max-height: 200px; overflow-y: auto;">{{range $key, $value := .HTTP.Headers}}{{$key}}: {{$value}}
{{end}}</div>
                    </div>
                </div>

                {{if .HTTP.Redirects}}
                <div style="margin-top: 1.5rem;">
                    <h3 style="font-size: 1rem; margin-bottom: 0.75rem;">Redirect Chain ({{len .HTTP.Redirects}} redirect{{if gt (len .HTTP.Redirects) 1}}s{{end}})</h3>
                    {{range $i, $redirect := .HTTP.Redirects}}
                    <div class="cert-card" style="margin-bottom: 1rem;">
                        <div class="cert-title" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Redirect #{{$i}} → {{$redirect.StatusCode}} {{$redirect.Status}}</span>
                            <span class="tag tag-warning">{{$redirect.StatusCode}}</span>
                        </div>
                        <div class="cert-detail"><strong>From:</strong> {{$redirect.From}}</div>
                        <div class="cert-detail"><strong>To:</strong> {{$redirect.To}}</div>
                        {{if $redirect.Headers}}
                        <div style="margin-top: 0.75rem;">
                            <div class="cert-detail"><strong>Response Headers:</strong></div>
                            <div class="code-block" style="max-height: 150px; overflow-y: auto; margin-top: 0.25rem; font-size: 0.75rem;">{{range $key, $value := $redirect.Headers}}{{$key}}: {{$value}}
{{end}}</div>
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
                {{end}}

                {{if .HTTP.Error}}
                <div style="margin-top: 1.5rem;">
                    <h3 style="font-size: 1rem; margin-bottom: 0.75rem; color: var(--error-color);">Error</h3>
                    <div class="code-block" style="background: #7f1d1d; color: #fecaca;">{{.HTTP.Error}}</div>
                </div>
                {{end}}
            </div>
        </div>

        <!-- Request Headers -->
        <div class="card">
            <div class="card-header">
                <h2>Request Headers</h2>
            </div>
            <div class="card-body">
                <div class="code-block">{{range $key, $value := .HTTP.RequestHeaders}}{{$key}}: {{$value}}
{{end}}</div>
            </div>
        </div>
        {{end}}

        {{if .Keytab}}
        <!-- Keytab Results -->
        <div class="card">
            <div class="card-header">
                <h2>Kerberos Keytab</h2>
                <span class="tag {{if .Keytab.Success}}tag-success{{else}}tag-error{{end}}">
                    {{if .Keytab.Success}}{{if .Keytab.Generated}}Generated{{else}}Existing{{end}}{{else}}Failed{{end}}
                </span>
            </div>
            <div class="card-body">
                <table class="table">
                    <tr>
                        <th>Principal</th>
                        <td>{{.Keytab.Principal}}</td>
                    </tr>
                    <tr>
                        <th>Path</th>
                        <td><code>{{.Keytab.Path}}</code></td>
                    </tr>
                    <tr>
                        <th>Duration</th>
                        <td>{{printf "%.2f" .Keytab.Duration.Milliseconds}}ms</td>
                    </tr>
                    {{if .Keytab.Error}}
                    <tr>
                        <th>Error</th>
                        <td style="color: var(--error-color)">{{.Keytab.Error}}</td>
                    </tr>
                    {{end}}
                </table>
            </div>
        </div>
        {{end}}

        <footer>
            Generated by http-audit | {{.Timestamp.Format "2006-01-02 15:04:05 MST"}}
        </footer>
    </div>

    <script>
        // Timing Chart
        const timingCtx = document.getElementById('timingChart').getContext('2d');
        new Chart(timingCtx, {
            type: 'bar',
            data: {
                {{if .SSL}}
                labels: ['DNS Lookup', 'TCP Connect', 'TLS Handshake', 'First Byte', 'Content Read'],
                datasets: [{
                    label: 'Duration (ms)',
                    data: [
                        {{printf "%.2f" .Timings.DNSLookup.Milliseconds}},
                        {{printf "%.2f" .Timings.TCPConnect.Milliseconds}},
                        {{printf "%.2f" .Timings.TLSHandshake.Milliseconds}},
                        {{printf "%.2f" .Timings.FirstByte.Milliseconds}},
                        {{printf "%.2f" .Timings.ContentRead.Milliseconds}}
                    ],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(139, 92, 246, 0.8)',
                        'rgba(236, 72, 153, 0.8)'
                    ],
                    borderColor: [
                        'rgba(59, 130, 246, 1)',
                        'rgba(16, 185, 129, 1)',
                        'rgba(245, 158, 11, 1)',
                        'rgba(139, 92, 246, 1)',
                        'rgba(236, 72, 153, 1)'
                    ],
                    borderWidth: 1
                }]
                {{else}}
                labels: ['DNS Lookup', 'TCP Connect', 'First Byte', 'Content Read'],
                datasets: [{
                    label: 'Duration (ms)',
                    data: [
                        {{printf "%.2f" .Timings.DNSLookup.Milliseconds}},
                        {{printf "%.2f" .Timings.TCPConnect.Milliseconds}},
                        {{printf "%.2f" .Timings.FirstByte.Milliseconds}},
                        {{printf "%.2f" .Timings.ContentRead.Milliseconds}}
                    ],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(139, 92, 246, 0.8)',
                        'rgba(236, 72, 153, 0.8)'
                    ],
                    borderColor: [
                        'rgba(59, 130, 246, 1)',
                        'rgba(16, 185, 129, 1)',
                        'rgba(139, 92, 246, 1)',
                        'rgba(236, 72, 153, 1)'
                    ],
                    borderWidth: 1
                }]
                {{end}}
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Time (ms)'
                        }
                    }
                }
            }
        });

        {{if and .DNS .DNS.ServerResults}}
        // DNS Server Comparison Chart
        const dnsCtx = document.getElementById('dnsChart').getContext('2d');
        new Chart(dnsCtx, {
            type: 'bar',
            data: {
                labels: [{{range $i, $sr := .DNS.ServerResults}}{{if $i}}, {{end}}'{{$sr.Server}}'{{end}}],
                datasets: [{
                    label: 'Response Time (ms)',
                    data: [{{range $i, $sr := .DNS.ServerResults}}{{if $i}}, {{end}}{{printf "%.2f" $sr.Duration.Milliseconds}}{{end}}],
                    backgroundColor: [{{range $i, $sr := .DNS.ServerResults}}{{if $i}}, {{end}}{{if $sr.Success}}'rgba(16, 185, 129, 0.8)'{{else}}'rgba(239, 68, 68, 0.8)'{{end}}{{end}}],
                    borderColor: [{{range $i, $sr := .DNS.ServerResults}}{{if $i}}, {{end}}{{if $sr.Success}}'rgba(16, 185, 129, 1)'{{else}}'rgba(239, 68, 68, 1)'{{end}}{{end}}],
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.parsed.x.toFixed(2) + ' ms';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Response Time (ms)'
                        }
                    }
                }
            }
        });
        {{end}}

        {{if and .SSL .SSL.SupportedVersions}}
        // TLS Version Support Chart
        const tlsCtx = document.getElementById('tlsChart').getContext('2d');
        new Chart(tlsCtx, {
            type: 'bar',
            data: {
                labels: [{{range $i, $v := .SSL.SupportedVersions}}{{if $i}}, {{end}}'{{$v.Version}}'{{end}}],
                datasets: [{
                    label: 'Support',
                    data: [{{range $i, $v := .SSL.SupportedVersions}}{{if $i}}, {{end}}{{if $v.Supported}}1{{else}}0{{end}}{{end}}],
                    backgroundColor: [{{range $i, $v := .SSL.SupportedVersions}}{{if $i}}, {{end}}{{if $v.Supported}}'rgba(16, 185, 129, 0.8)'{{else}}'rgba(239, 68, 68, 0.8)'{{end}}{{end}}],
                    borderColor: [{{range $i, $v := .SSL.SupportedVersions}}{{if $i}}, {{end}}{{if $v.Supported}}'rgba(16, 185, 129, 1)'{{else}}'rgba(239, 68, 68, 1)'{{end}}{{end}}],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 1,
                        ticks: {
                            callback: function(value) {
                                return value === 1 ? 'Supported' : 'Not Supported';
                            }
                        }
                    }
                }
            }
        });
        {{end}}
    </script>
</body>
</html>
